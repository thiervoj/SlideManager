{"version":3,"file":"slidemanager.modern.js","sources":["../src/raf-interval.js","../src/slidemanager.js"],"sourcesContent":["const queue = []\r\nlet id = -1\r\nlet ticking = false\r\nlet tickId = null\r\n\r\nexport const setRafInterval = (fn, interval) => {\r\n  id++\r\n\r\n  queue.push({\r\n    id,\r\n    fn,\r\n    interval,\r\n    lastTime: performance.now()\r\n  })\r\n\r\n  if (!ticking) {\r\n    const tick = () => {\r\n      tickId = requestAnimationFrame(tick)\r\n\r\n      queue.forEach((item) => {\r\n        if (item.interval < 17 || performance.now() - item.lastTime >= item.interval) {\r\n          item.fn()\r\n          item.lastTime = performance.now()\r\n        }\r\n      })\r\n    }\r\n\r\n    ticking = true\r\n\r\n    tick()\r\n  }\r\n\r\n  return id\r\n}\r\n\r\nexport const clearRafInterval = (rafID) => {\r\n  for (let i = 0; i < queue.length; i++) {\r\n    if (rafID === queue[i].id) {\r\n      queue.splice(i, 1)\r\n\r\n      break\r\n    }\r\n  }\r\n\r\n  if (queue.length === 0) {\r\n    cancelAnimationFrame(tickId)\r\n\r\n    ticking = false\r\n  }\r\n}\r\n","import { setRafInterval, clearRafInterval } from './raf-interval'\r\n\r\nexport default class Slidemanager {\r\n  constructor(opt = {}) {\r\n    if (!opt.callback) {\r\n      console.warn('Slidemanager: Missing `callback` property in constructor.')\r\n\r\n      return\r\n    }\r\n\r\n    if (this.max === -1) {\r\n      console.warn('Slidemanager: Missing `el` or `length` property in constructor.')\r\n\r\n      return\r\n    }\r\n\r\n    this.bindMethods()\r\n\r\n    const defaults = {\r\n      el: null,\r\n      loop: false,\r\n      random: false,\r\n      vertical: false,\r\n      callback: this.done,\r\n      auto: false,\r\n      interval: 5,\r\n      init: true,\r\n      swipe: true,\r\n      mouseSwipe: false,\r\n      startAt: 0,\r\n      threshold: 60\r\n    }\r\n\r\n    this.options = Object.assign(defaults, opt)\r\n\r\n    this.el = opt.el\r\n    this.changing = false\r\n    this.max = opt.length > 0 ? opt.length : opt.el && opt.el.children ? opt.el.children.length : -1\r\n    this.index = !isNaN(opt.startAt) && opt.startAt !== defaults.startAt ? Math.max(0, Math.min(opt.startAt, this.max)) : 0\r\n\r\n    this.intervalID = null\r\n\r\n    this.touch = {\r\n      startX: 0,\r\n      startY: 0,\r\n      endX: 0,\r\n      endY: 0\r\n    }\r\n\r\n    this.diagonalMax = 125\r\n\r\n    if (this.options.init) this.init()\r\n  }\r\n\r\n  bindMethods() {\r\n    this.intervalFn = this.intervalFn.bind(this)\r\n    this.startAuto = this.startAuto.bind(this)\r\n    this.stopAuto = this.stopAuto.bind(this)\r\n    this.touchStart = this.touchStart.bind(this)\r\n    this.touchEnd = this.touchEnd.bind(this)\r\n    this.done = this.done.bind(this)\r\n  }\r\n\r\n  // Public functions\r\n  init() {\r\n    if (this.max === 0) return null\r\n\r\n    if (this.options.auto) this.startAuto()\r\n\r\n    if (this.options.swipe) this.events()\r\n\r\n    return this\r\n  }\r\n\r\n  destroy() {\r\n    if (this.max === 0) return null\r\n\r\n    this.changing = false\r\n\r\n    if (this.options.swipe && this.el) {\r\n      if (this.options.mouseSwipe) {\r\n        this.el.removeEventListener('mousedown', this.touchStart)\r\n        this.el.removeEventListener('mouseup', this.touchEnd)\r\n      }\r\n\r\n      this.el.removeEventListener('touchstart', this.touchStart)\r\n      this.el.removeEventListener('touchend', this.touchEnd)\r\n    }\r\n\r\n    if (this.options.auto) this.stopAuto()\r\n\r\n    return this\r\n  }\r\n\r\n  getIndex() {\r\n    return this.index\r\n  }\r\n\r\n  prev() {\r\n    this.goTo(this.index - 1)\r\n  }\r\n\r\n  next() {\r\n    this.goTo(this.index + 1)\r\n  }\r\n\r\n  goTo(index, data) {\r\n    if (index === this.index || this.isChanging()) return\r\n\r\n    const checkedIndex = this.checkLoop(index)\r\n    const event = this.createEvent(checkedIndex, data)\r\n\r\n    if (checkedIndex === this.index) {\r\n      this.changing = false\r\n\r\n      return\r\n    }\r\n\r\n    this.index = checkedIndex\r\n    this.options.callback(event)\r\n  }\r\n\r\n  done() {\r\n    this.changing = false\r\n\r\n    if (this.options.auto) this.startAuto()\r\n  }\r\n\r\n  // Private functions\r\n  events() {\r\n    if (!this.el) return\r\n\r\n    if (this.options.mouseSwipe) {\r\n      this.el.addEventListener('mousedown', this.touchStart)\r\n      this.el.addEventListener('mouseup', this.touchEnd)\r\n    }\r\n\r\n    this.el.addEventListener('touchstart', this.touchStart)\r\n    this.el.addEventListener('touchend', this.touchEnd)\r\n  }\r\n\r\n  touchStart(event) {\r\n    this.touch.startX = event.type === 'touchstart' ? event.touches[0].screenX : event.screenX\r\n    this.touch.startY = event.type === 'touchstart' ? event.touches[0].screenY : event.screenY\r\n  }\r\n\r\n  touchEnd(event) {\r\n    this.touch.endX = event.type === 'touchend' ? event.changedTouches[0].screenX : event.screenX\r\n    this.touch.endY = event.type === 'touchend' ? event.changedTouches[0].screenY : event.screenY\r\n\r\n    this.handleSwipe()\r\n  }\r\n\r\n  isGoingToX() {\r\n    return this.touch.endX < this.touch.startX && this.touch.startX - this.touch.endX <= this.diagonalMax || this.touch.endX > this.touch.startX && this.touch.endX - this.touch.startX <= this.diagonalMax\r\n  }\r\n\r\n  isGoingToY() {\r\n    return this.touch.endY < this.touch.startY && this.touch.startY - this.touch.endY <= this.diagonalMax || this.touch.endY > this.touch.startY && this.touch.endY - this.touch.startY <= this.diagonalMax\r\n  }\r\n\r\n  handleSwipe() {\r\n    if (this.changing) return\r\n\r\n    if (this.options.vertical) {\r\n      if (this.touch.endY < this.touch.startY && this.touch.startY - this.touch.endY >= this.options.threshold) {\r\n        if (this.isGoingToX()) this.callback(-1)\r\n      }\r\n      if (this.touch.endY > this.touch.startY && this.touch.endY - this.touch.startY >= this.options.threshold) {\r\n        if (this.isGoingToX()) this.callback(1)\r\n      }\r\n    } else {\r\n      if (this.touch.endX < this.touch.startX && this.touch.startX - this.touch.endX >= this.options.threshold) {\r\n        if (this.isGoingToY()) this.callback(-1)\r\n      }\r\n      if (this.touch.endX > this.touch.startX && this.touch.endX - this.touch.startX >= this.options.threshold) {\r\n        if (this.isGoingToY()) this.callback(1)\r\n      }\r\n    }\r\n  }\r\n\r\n  startAuto() {\r\n    if (this.intervalID) this.stopAuto()\r\n\r\n    this.intervalID = setRafInterval(this.intervalFn, this.options.interval * 1000)\r\n  }\r\n\r\n  intervalFn() {\r\n    if (this.changing) return\r\n\r\n    this.callback(-1)\r\n  }\r\n\r\n  stopAuto() {\r\n    clearRafInterval(this.intervalID)\r\n\r\n    this.intervalID = null\r\n  }\r\n\r\n  isChanging() {\r\n    if (this.changing) return true\r\n\r\n    this.changing = true\r\n\r\n    return false\r\n  }\r\n\r\n  newIndex(delta) {\r\n    return this.checkLoop(delta > 0 ? this.index - 1 : this.index + 1)\r\n  }\r\n\r\n  newRandomIndex() {\r\n    let randIndex\r\n\r\n    do {\r\n      randIndex = Math.floor(Math.random() * this.max)\r\n    } while (randIndex === this.index)\r\n\r\n    return randIndex\r\n  }\r\n\r\n  checkLoop(index) {\r\n    return index < 0 ? this.options.loop ? this.max - 1 : 0 : index > this.max - 1 ? this.options.loop ? 0 : this.max - 1 : index\r\n  }\r\n\r\n  createEvent(newIndex, data) {\r\n    let direction = newIndex > this.index ? 1 : -1\r\n\r\n    if (this.index === 0 && newIndex === this.max - 1) direction = -1\r\n    else if (this.index === this.max - 1 && newIndex === 0) direction = 1\r\n\r\n    return {\r\n      current: newIndex,\r\n      previous: this.index,\r\n      direction,\r\n      data,\r\n      done: this.done\r\n    }\r\n  }\r\n\r\n  callback(delta) {\r\n    if (this.isChanging()) return\r\n\r\n    const index = this.options.random ? this.newRandomIndex() : this.newIndex(delta)\r\n    const event = this.createEvent(index)\r\n\r\n    if (index === this.index) {\r\n      this.changing = false\r\n\r\n      return\r\n    }\r\n\r\n    if (this.options.auto) this.stopAuto()\r\n\r\n    this.index = index\r\n    this.options.callback(event)\r\n  }\r\n}\r\n"],"names":["queue","id","ticking","tickId","constructor","opt","callback","console","warn","this","max","bindMethods","defaults","el","loop","random","vertical","done","auto","interval","init","swipe","mouseSwipe","startAt","threshold","options","Object","assign","changing","length","children","index","isNaN","Math","min","intervalID","touch","startX","startY","endX","endY","diagonalMax","intervalFn","bind","startAuto","stopAuto","touchStart","touchEnd","events","destroy","removeEventListener","getIndex","prev","goTo","next","data","isChanging","checkedIndex","checkLoop","event","createEvent","addEventListener","type","touches","screenX","screenY","changedTouches","handleSwipe","isGoingToX","isGoingToY","fn","push","lastTime","performance","now","tick","requestAnimationFrame","forEach","item","setRafInterval","rafID","i","splice","cancelAnimationFrame","clearRafInterval","newIndex","delta","newRandomIndex","randIndex","floor","direction","current","previous"],"mappings":"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"}