"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},_createClass=function(){function s(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,i,e){return i&&s(t.prototype,i),e&&s(t,e),t}}();function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var SlideManager=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,i),t.callback)if(this.el=t.el,this.changing=!1,this.index=0,this.max=-1,0<t.length?this.max=t.length:this.el.children&&(this.max=this.el.children.length),-1!==this.max){this.options=_extends({el:null,loop:!1,random:!1,vertical:!1,callback:function(){},auto:!1,interval:5,init:!0,swipe:!0,mouseSwipe:!1,threshold:60},t),t.startAt!==this.index&&0<t.startAt&&(t.startAt>this.max?this.index=this.max:this.index=t.startAt),this.intervalID=null,this.touch={startX:0,startY:0,endX:0,endY:0},this.diagonalMax=125,this.options.callback=this.options.callback.bind(this),this.touchStart=this.touchStart.bind(this),this.touchEnd=this.touchEnd.bind(this),this.options.init&&this.init()}else console.error("You must give an element or a length");else console.error("You must give a callback")}return _createClass(i,[{key:"init",value:function(){return 0===this.max?null:(this.options.auto&&this.startAuto(),this.options.swipe&&this.events(),this)}},{key:"destroy",value:function(){return 0===this.max?null:(this.changing=!1,this.options.swipe&&this.el&&(this.options.mouseSwipe&&(this.el.removeEventListener("mousedown",this.touchStart,!1),this.el.removeEventListener("mouseup",this.touchEnd,!1)),this.el.removeEventListener("touchstart",this.touchStart,!1),this.el.removeEventListener("touchend",this.touchEnd,!1)),this.options.auto&&this.stopAuto(),this)}},{key:"getIndex",value:function(){return this.index}},{key:"prev",value:function(){this.goTo(this.index-1)}},{key:"next",value:function(){this.goTo(this.index+1)}},{key:"goTo",value:function(t,i){if(t!==this.index&&!this.isChanging()){var e=this.checkLoop(t),s=this.createEvent(e,i);e!==this.index?(this.index=e,this.options.callback(s)):this.changing=!1}}},{key:"done",value:function(){this.changing=!1,this.options.auto&&this.startAuto()}},{key:"events",value:function(){this.el&&(this.options.mouseSwipe&&(this.el.addEventListener("mousedown",this.touchStart,!1),this.el.addEventListener("mouseup",this.touchEnd,!1)),this.el.addEventListener("touchstart",this.touchStart,!1),this.el.addEventListener("touchend",this.touchEnd,!1))}},{key:"touchStart",value:function(t){this.touch.startX="touchstart"===t.type?t.touches[0].screenX:t.screenX,this.touch.startY="touchstart"===t.type?t.touches[0].screenY:t.screenY}},{key:"touchEnd",value:function(t){this.touch.endX="touchend"===t.type?t.changedTouches[0].screenX:t.screenX,this.touch.endY="touchend"===t.type?t.changedTouches[0].screenY:t.screenY,this.handleSwipe()}},{key:"isGoingToX",value:function(){return this.touch.endX<this.touch.startX&&this.touch.startX-this.touch.endX<=this.diagonalMax||this.touch.endX>this.touch.startX&&this.touch.endX-this.touch.startX<=this.diagonalMax}},{key:"isGoingToY",value:function(){return this.touch.endY<this.touch.startY&&this.touch.startY-this.touch.endY<=this.diagonalMax||this.touch.endY>this.touch.startY&&this.touch.endY-this.touch.startY<=this.diagonalMax}},{key:"handleSwipe",value:function(){this.changing||(this.options.vertical?(this.touch.endY<this.touch.startY&&this.touch.startY-this.touch.endY>=this.options.threshold&&this.isGoingToX()&&this.callback(-1),this.touch.endY>this.touch.startY&&this.touch.endY-this.touch.startY>=this.options.threshold&&this.isGoingToX()&&this.callback(1)):(this.touch.endX<this.touch.startX&&this.touch.startX-this.touch.endX>=this.options.threshold&&this.isGoingToY()&&this.callback(-1),this.touch.endX>this.touch.startX&&this.touch.endX-this.touch.startX>=this.options.threshold&&this.isGoingToY()&&this.callback(1)))}},{key:"startAuto",value:function(){var t=this;this.intervalID=setInterval(function(){t.changing||t.callback(-1)},1e3*this.options.interval)}},{key:"stopAuto",value:function(){clearInterval(this.intervalID),this.intervalID=null}},{key:"isChanging",value:function(){return!!this.changing||!(this.changing=!0)}},{key:"newIndex",value:function(t){return this.checkLoop(0<t?this.index-1:this.index+1)}},{key:"newRandomIndex",value:function(){for(var t=void 0;(t=Math.floor(Math.random()*this.max))===this.index;);return t}},{key:"checkLoop",value:function(t){return t<0?this.options.loop?this.max-1:0:t>this.max-1?this.options.loop?0:this.max-1:t}},{key:"createEvent",value:function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=t>this.index?1:-1;return 2<this.max&&(0===this.index&&t===this.max-1?e=-1:this.index===this.max-1&&0===t&&(e=1)),{new:t,previous:this.index,direction:e,data:i}}},{key:"callback",value:function(t){if(!this.isChanging()){var i=this.options.random?this.newRandomIndex():this.newIndex(t),e=this.createEvent(i);i!==this.index?(this.options.auto&&this.stopAuto(),this.index=i,this.options.callback(e)):this.changing=!1}}}]),i}();exports.default=SlideManager;
